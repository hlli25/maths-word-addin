<!-- Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT License. -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Equation Editor</title>

    <!-- Office JavaScript API -->
    <script type="text/javascript" src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>

    <!-- For more information on Fluent UI, visit https://developer.microsoft.com/fluentui#/. -->
    <link rel="stylesheet" href="https://res-1.cdn.office.net/files/fabric-cdn-prod_20230815.002/office-ui-fabric-core/11.1.0/css/fabric.min.css"/>

    <!-- Template styles -->
    <link href="taskpane.css" rel="stylesheet" type="text/css" />

    <!-- MathJax configuration and loading -->
    <script>
        window.MathJax = {
            loader: {load: ['[tex]/boldsymbol', '[tex]/color']},
            tex: {
                packages: {'[+]': ['base', 'boldsymbol', 'color', 'ams']},
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            },
            svg: {
                fontCache: 'local',
                scale: 1,
                minScale: 0.5,
                matchFontHeight: true, // Enable baseline calculation for proper alignment
                displayIndent: '0',
                mtextInheritFont: true, // Allow text elements to inherit the surrounding font
                unknownFamily: 'serif'
            },
            startup: {
                ready: () => {
                    MathJax.startup.defaultReady();
                    MathJax.startup.document.updateDocument();
                }
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
</head>

<body class="ms-font-m">
    <div id="app-container">
        <h1 class="ms-fontSize-xl ms-fontWeight-bold">Equation Editor</h1>
        <p class="ms-fontSize-m ms-fontWeight-regular">Build your equation using the visual editor below.</p>
        
        <!-- Equation Builder Display -->
        <div class="equation-display equation-container" id="equationDisplay" data-context-path="root">
            <span class="empty-state">Click here and start typing your equation</span>
        </div>
        <input type="text" class="equation-input" id="hiddenInput" />


        <!-- Format Controls -->
        <div class="font-controls">
            <!-- Font Size Combobox -->
            <div class="control-group">
                <div class="font-size-container">
                    <div class="font-size-combobox">
                        <input type="text" id="fontSizeInput" class="font-size-input" value="12" />
                        <button class="font-size-dropdown-btn" id="fontSizeDropdownBtn" type="button">
                            <span class="dropdown-arrow">▼</span>
                        </button>
                        <div class="font-size-dropdown" id="fontSizeDropdown">
                            <div class="font-size-option" data-size="8">8</div>
                            <div class="font-size-option" data-size="9">9</div>
                            <div class="font-size-option" data-size="10">10</div>
                            <div class="font-size-option" data-size="11">11</div>
                            <div class="font-size-option" data-size="12">12</div>
                            <div class="font-size-option" data-size="14">14</div>
                            <div class="font-size-option" data-size="16">16</div>
                            <div class="font-size-option" data-size="18">18</div>
                            <div class="font-size-option" data-size="20">20</div>
                            <div class="font-size-option" data-size="24">24</div>
                            <div class="font-size-option" data-size="28">28</div>
                            <div class="font-size-option" data-size="32">32</div>
                            <div class="font-size-option" data-size="36">36</div>
                            <div class="font-size-option" data-size="48">48</div>
                            <div class="font-size-option" data-size="72">72</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Format Buttons -->
            <div class="format-buttons">
                <button class="format-btn bold-btn" id="boldBtn" title="Bold (Ctrl+B)">
                    <strong>B</strong>
                </button>
                <button class="format-btn italic-btn" id="italicBtn" title="Italic (Ctrl+I)">
                    <em>I</em>
                </button>
                <div class="underline-dropdown-container">
                    <button class="format-btn underline-btn" id="underlineBtn" title="Underline">
                        <span style="text-decoration: underline;">U</span>
                    </button>
                    <button class="format-btn underline-dropdown-btn" id="underlineDropdownBtn" title="More Underline Styles">
                        <span class="dropdown-arrow">▼</span>
                    </button>
                    <div class="underline-dropdown" id="underlineDropdown">
                        <div class="underline-option" data-underline="single">
                            <span class="underline-visual single-line">_____________</span>
                        </div>
                        <div class="underline-option" data-underline="double">
                            <span class="underline-visual double-line">_____________</span>
                        </div>
                        <div class="underline-option" data-underline="none">None</div>
                    </div>
                </div>
                <button class="format-btn cancel-btn" id="cancelBtn" title="Cancel">
                    <span class="cancel-icon">S</span>
                </button>
                <div class="color-dropdown-container">
                    <button class="format-btn color-btn" id="colorBtn" title="Text Color">
                        <span class="color-icon">A</span>
                        <div class="color-preview" id="colorPreview"></div>
                    </button>
                    <button class="format-btn color-dropdown-btn" id="colorDropdownBtn" title="More Colors">
                        <span class="dropdown-arrow">▼</span>
                    </button>
                    <div class="color-panel" id="colorPanel">
                        <div class="color-grid">
                            <!-- Row 1 - Grayscale -->
                            <div class="color-row">
                                <div class="color-square" data-color="#000000" style="background-color: #000000;" title="Black"></div>
                                <div class="color-square" data-color="#434343" style="background-color: #434343;" title="Dark Gray 4"></div>
                                <div class="color-square" data-color="#666666" style="background-color: #666666;" title="Dark Gray 3"></div>
                                <div class="color-square" data-color="#999999" style="background-color: #999999;" title="Dark Gray 2"></div>
                                <div class="color-square" data-color="#B7B7B7" style="background-color: #B7B7B7;" title="Dark Gray 1"></div>
                                <div class="color-square" data-color="#CCCCCC" style="background-color: #CCCCCC;" title="Gray"></div>
                                <div class="color-square" data-color="#D9D9D9" style="background-color: #D9D9D9;" title="Light Gray 1"></div>
                                <div class="color-square" data-color="#EFEFEF" style="background-color: #EFEFEF;" title="Light Gray 2"></div>
                                <div class="color-square" data-color="#F3F3F3" style="background-color: #F3F3F3;" title="Light Gray 3"></div>
                                <div class="color-square" data-color="#FFFFFF" style="background-color: #FFFFFF; border: 1px solid #ccc;" title="White"></div>
                            </div>
                            <!-- Row 2 - Bright Colors -->
                            <div class="color-row">
                                <div class="color-square" data-color="#980000" style="background-color: #980000;" title="Dark Red"></div>
                                <div class="color-square" data-color="#FF0000" style="background-color: #FF0000;" title="Red"></div>
                                <div class="color-square" data-color="#FF9900" style="background-color: #FF9900;" title="Orange"></div>
                                <div class="color-square" data-color="#FFFF00" style="background-color: #FFFF00;" title="Yellow"></div>
                                <div class="color-square" data-color="#00FF00" style="background-color: #00FF00;" title="Green"></div>
                                <div class="color-square" data-color="#00FFFF" style="background-color: #00FFFF;" title="Cyan"></div>
                                <div class="color-square" data-color="#4A86E8" style="background-color: #4A86E8;" title="Light Blue"></div>
                                <div class="color-square" data-color="#0000FF" style="background-color: #0000FF;" title="Blue"></div>
                                <div class="color-square" data-color="#9900FF" style="background-color: #9900FF;" title="Purple"></div>
                                <div class="color-square" data-color="#FF00FF" style="background-color: #FF00FF;" title="Magenta"></div>
                            </div>
                            <!-- Row 3 - Dark Colors -->
                            <div class="color-row">
                                <div class="color-square" data-color="#85200C" style="background-color: #85200C;" title="Dark Red 2"></div>
                                <div class="color-square" data-color="#990000" style="background-color: #990000;" title="Dark Red 3"></div>
                                <div class="color-square" data-color="#B45F06" style="background-color: #B45F06;" title="Dark Orange"></div>
                                <div class="color-square" data-color="#BF9000" style="background-color: #BF9000;" title="Dark Yellow"></div>
                                <div class="color-square" data-color="#38761D" style="background-color: #38761D;" title="Dark Green"></div>
                                <div class="color-square" data-color="#134F5C" style="background-color: #134F5C;" title="Dark Cyan"></div>
                                <div class="color-square" data-color="#1155CC" style="background-color: #1155CC;" title="Dark Blue 1"></div>
                                <div class="color-square" data-color="#0B5394" style="background-color: #0B5394;" title="Dark Blue 2"></div>
                                <div class="color-square" data-color="#351C75" style="background-color: #351C75;" title="Dark Purple"></div>
                                <div class="color-square" data-color="#741B47" style="background-color: #741B47;" title="Dark Magenta"></div>
                            </div>
                        </div>
                        <div class="hex-input-section">
                            <div class="hex-input-row">
                                <label for="hexInput">Hex code:</label>
                                <div class="hex-input-container">
                                    <input type="text" id="hexInput" class="hex-input" value="#000000" maxlength="7" placeholder="#000000" />
                                    <div class="hex-color-preview" id="hexColorPreview"></div>
                                </div>
                            </div>
                            <div class="hex-actions">
                                <button class="hex-btn hex-ok-btn" id="colorOkBtn">OK</button>
                                <button class="hex-btn hex-cancel-btn" id="colorCancelBtn">Cancel</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Button Panel with Tabs -->
        <div class="tab-panel">
            <div class="tab-nav-container">
                <button class="tab-scroll-btn tab-scroll-left" id="tabScrollLeft">
                    <svg width="8" height="12" viewBox="0 0 8 8">
                        <path d="M8 2 L4 6 L8 10" stroke="currentColor" fill="none" stroke-width="1.5"/>
                    </svg>
                </button>
                <div class="tab-nav" id="tabNav">
                    <button class="tab-btn active" data-tab="structures">Structures</button>
                    <button class="tab-btn" data-tab="brackets">Brackets</button>
                    <button class="tab-btn" data-tab="operators">Operators</button>
                    <button class="tab-btn" data-tab="larger-operators">Larger Operators</button>
                </div>
                <button class="tab-scroll-btn tab-scroll-right" id="tabScrollRight">
                    <svg width="12" height="12" viewBox="0 0 12 12">
                        <path d="M4 2 L8 6 L4 10" stroke="currentColor" fill="none" stroke-width="1.5"/>
                    </svg>
                </button>
            </div>
            <div class="tab-content">
                <div id="structures" class="tab-pane active">
                    <div class="button-row">
                        <button class="builder-btn fraction-btn" title="Fraction">
                            <math>
                                <mfrac>
                                    <mi>□</mi>
                                    <mi>□</mi>
                                </mfrac>
                            </math>
                        </button>
                        <button class="builder-btn bevelled-fraction-btn" title="Bevelled Fraction">
                            <math>
                                <mi>□</mi>
                                <mo>/</mo>
                                <mi>□</mi>
                            </math>
                        </button>
                        <button class="builder-btn sqrt-btn" title="Square Root">
                            <math>
                                <msqrt>
                                    <mi>□</mi>
                                </msqrt>
                            </math>
                        </button>
                        <button class="builder-btn nthroot-btn" title="Root">
                            <math>
                                <mroot>
                                    <mi>□</mi>
                                    <mi>□</mi>
                                </mroot>
                            </math>
                        </button>
                        <button class="builder-btn sup-btn" title="Superscript">
                            <math>
                                <msup>
                                    <mi>□</mi>
                                    <mi>□</mi>
                                </msup>
                            </math>
                        </button>
                        <button class="builder-btn sub-btn" title="Subscript">
                            <math>
                                <msub>
                                    <mi>□</mi>
                                    <mi>□</mi>
                                </msub>
                            </math>
                        </button>
                        <button class="builder-btn sup-sub-btn" title="Superscript-Subscript">
                            <math>
                                <msubsup>
                                    <mi>□</mi>
                                    <mi>□</mi>
                                    <mi>□</mi>
                                </msubsup>
                            </math>
                        </button>
                    </div>
                </div>
                <div id="brackets" class="tab-pane">
                    <div class="builder-grid">
                        <button class="builder-btn bracket-preset-btn" data-bracket="()" title="Parentheses">(□)</button>
                        <button class="builder-btn bracket-preset-btn" data-bracket="[]" title="Square Brackets">[□]</button>
                        <button class="builder-btn bracket-preset-btn" data-bracket="{}" title="Curly Brackets">{□}</button>
                        <button class="builder-btn bracket-preset-btn" data-bracket="⌊⌋" title="Floor Brackets">⌊□⌋</button>
                        <button class="builder-btn bracket-preset-btn" data-bracket="⌈⌉" title="Ceiling Brackets">⌈□⌉</button>
                        <button class="builder-btn bracket-preset-btn" data-bracket="||" title="Absolute Value">|□|</button>
                        <button class="builder-btn bracket-preset-btn" data-bracket="‖‖" title="Norm">‖□‖</button>
                        <button class="builder-btn bracket-preset-btn" data-bracket="⟨⟩" title="Angle Brackets">⟨□⟩</button>
                    </div>
                    <hr class="bracket-separator">
                    <div class="bracket-builder">
                        <div class="bracket-component">
                            <select id="leftBracketSelect" class="bracket-select">
                                <option value="(" selected>(</option>
                                <option value="[">[</option>
                                <option value="{">{</option>
                                <option value="⌊">⌊</option>
                                <option value="⌈">⌈</option>
                                <option value="|">|</option>
                                <option value="‖">‖</option>
                                <option value="⟨">⟨</option>
                            </select>
                        </div>
                        
                        <div class="bracket-component bracket-input">
                            <div class="bracket-input-display">□</div>
                        </div>
                        
                        <div class="bracket-component">
                            <select id="rightBracketSelect" class="bracket-select">
                                <option value=")" selected>)</option>
                                <option value="]">]</option>
                                <option value="}">}</option>
                                <option value="⌋">⌋</option>
                                <option value="⌉">⌉</option>
                                <option value="|">|</option>
                                <option value="‖">‖</option>
                                <option value="⟩">⟩</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="bracket-actions">
                        <button id="insertCustomBracket" class="builder-btn custom-bracket-btn">Insert Bracket(s)</button>
                    </div>
                </div>
                <div id="operators" class="tab-pane">
                    <div class="button-row">
                        <button class="builder-btn operator-btn" data-operator="\times"><math><mo>×</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\div"><math><mo>÷</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\pm"><math><mo>±</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\mp"><math><mo>∓</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\cdot"><math><mo>·</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\ast"><math><mo>∗</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\star"><math><mo>⋆</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\circ"><math><mo>∘</mo></math></button>
                    </div>
                    <div class="button-row">
                        <button class="builder-btn operator-btn" data-operator="\bullet"><math><mo>•</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\neq"><math><mo>≠</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\sim"><math><mo>∼</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\simeq"><math><mo>≃</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\approx"><math><mo>≈</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\equiv"><math><mo>≡</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\cong"><math><mo>≅</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\ncong"><math><mo>≇</mo></math></button>
                    </div>
                    <div class="button-row">
                        <button class="builder-btn operator-btn" data-operator="\propto"><math><mo>∝</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\leq"><math><mo>≤</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\geq"><math><mo>≥</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\nless"><math><mo>≮</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\ngtr"><math><mo>≯</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\nleq"><math><mo>≰</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\ngeq"><math><mo>≱</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\prec"><math><mo>≺</mo></math></button>
                    </div>
                    <div class="button-row">
                        <button class="builder-btn operator-btn" data-operator="\succ"><math><mo>≻</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\preceq"><math><mo>⪯</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\succeq"><math><mo>⪰</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\ll"><math><mo>≪</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\gg"><math><mo>≫</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\cap"><math><mo>∩</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\cup"><math><mo>∪</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\setminus"><math><mo>∖</mo></math></button>
                    </div>
                    <div class="button-row">
                        <button class="builder-btn operator-btn" data-operator="\in"><math><mo>∈</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\ni"><math><mo>∋</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\notin"><math><mo>∉</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\subset"><math><mo>⊂</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\supset"><math><mo>⊃</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\subseteq"><math><mo>⊆</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\supseteq"><math><mo>⊇</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\nsubseteq"><math><mo>⊈</mo></math></button>
                    </div>
                    <div class="button-row">
                        <button class="builder-btn operator-btn" data-operator="\nsupseteq"><math><mo>⊉</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\subsetneq"><math><mo>⊊</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\supsetneq"><math><mo>⊋</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\oplus"><math><mo>⊕</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\ominus"><math><mo>⊖</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\otimes"><math><mo>⊗</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\oslash"><math><mo>⊘</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\odot"><math><mo>⊙</mo></math></button>
                    </div>
                    <div class="button-row">
                        <button class="builder-btn operator-btn" data-operator="\triangleleft"><math><mo>◁</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\triangleright"><math><mo>▷</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\wr"><math><mo>≀</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\wedge"><math><mo>∧</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\vee"><math><mo>∨</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\vdash"><math><mo>⊢</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\models"><math><mo>⊨</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\top"><math><mo>⊤</mo></math></button>
                    </div>
                    <div class="button-row">
                        <button class="builder-btn operator-btn" data-operator="\bot"><math><mo>⊥</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\bowtie"><math><mo>⋈</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\diamond"><math><mo>⋄</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\asymp"><math><mo>≍</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\triangleq"><math><mo>≜</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\therefore"><math><mo>∴</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\because"><math><mo>∵</mo></math></button>
                    </div>
                </div>
                <div id="larger-operators" class="tab-pane">
                    <div class="button-row">
                        <button class="builder-btn large-operator-btn sum-nolimit-btn" title="Sum nolimits (side positioning)">
                            <math>
                                <mrow>
                                    <msubsup>
                                        <mo class="sum-operator-inline">∑</mo>
                                        <mi class="sum-limit-inline">□</mi>
                                        <mi class="sum-limit-inline">□</mi>
                                    </msubsup>
                                    <mi class="sum-operand-inline">□</mi>
                                </mrow>
                            </math>
                        </button>
                        <button class="builder-btn large-operator-btn sum-limit-btn" title="Sum limits (above/below positioning)">
                            <math>
                                <mrow>
                                    <munderover>
                                        <mo class="sum-operator-inline" movablelimits="false">∑</mo>
                                        <mi class="sum-limit-inline">□</mi>
                                        <mi class="sum-limit-inline">□</mi>
                                    </munderover>
                                    <mi class="sum-operand-inline">□</mi>
                                </mrow>
                            </math>
                        </button>
                        <button class="builder-btn large-operator-btn sum-display-nolimit-btn" title="Display sum nolimits (large, side positioning)">
                            <math displaystyle="true">
                                <mrow>
                                    <msubsup>
                                        <mo class="sum-operator-display">∑</mo>
                                        <mi class="sum-limit-display">□</mi>
                                        <mi class="sum-limit-display">□</mi>
                                    </msubsup>
                                    <mi class="sum-operand-display">□</mi>
                                </mrow>
                            </math>
                        </button>
                        <button class="builder-btn large-operator-btn sum-display-limit-btn" title="Display sum limits (large, above/below positioning)">
                            <math displaystyle="true">
                                <mrow>
                                    <munderover>
                                        <mo class="sum-operator-display">∑</mo>
                                        <mi class="sum-limit-display">□</mi>
                                        <mi class="sum-limit-display">□</mi>
                                    </munderover>
                                    <mi class="sum-operand-display">□</mi>
                                </mrow>
                            </math>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Container for the action buttons and status messages -->
        <div class="footer">
            <div class="footer-controls">
                <button id="clear-equation-button" class="ms-Button ms-Button--secondary">
                    <span class="ms-Button-label">Clear</span>
                </button>
                <button id="insert-equation-button" class="ms-Button ms-Button--primary">
                    <span class="ms-Button-label">Insert Equation</span>
                </button>
            </div>
            <div id="status"></div>
        </div>
        
        <!-- Hidden container for MathJax rendering -->
        <div id="mathjax-renderer"></div>
    </div>
</body>

</html>