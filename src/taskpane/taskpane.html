<!-- Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT License. -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Equation Editor</title>

    <!-- Office JavaScript API -->
    <script type="text/javascript" src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>

    <!-- For more information on Fluent UI, visit https://developer.microsoft.com/fluentui#/. -->
    <link rel="stylesheet" href="https://res-1.cdn.office.net/files/fabric-cdn-prod_20230815.002/office-ui-fabric-core/11.1.0/css/fabric.min.css"/>

    <!-- Template styles -->
    <link href="taskpane.css" rel="stylesheet" type="text/css" />

    <!-- MathJax configuration and loading -->
    <script>
        window.MathJax = {
            tex: {
                packages: {'[+]': ['textmacros', 'cancel', 'color', 'ams']},
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            },
            svg: {
                fontCache: 'local',
                scale: 1,
                minScale: 0.5,
                matchFontHeight: true, // Enable baseline calculation for proper alignment
                displayIndent: '0',
                mtextInheritFont: true, // Allow text elements to inherit the surrounding font
                unknownFamily: 'serif'
            },
            startup: {
                ready: () => {
                    MathJax.startup.defaultReady();
                    MathJax.startup.document.updateDocument();
                }
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
</head>

<body class="ms-font-m">
    <div id="app-container">
        <h1 class="ms-fontSize-xl ms-fontWeight-bold">Equation Editor</h1>
        <p class="ms-fontSize-m ms-fontWeight-regular">Build your equation using the visual editor below.</p>
        
        <!-- Equation Builder Display -->
        <div class="equation-display equation-container" id="equationDisplay" data-context-path="root">
            <span class="empty-state">Click here and start typing your equation</span>
        </div>
        <input type="text" class="equation-input" id="hiddenInput" />


        <!-- Font Size Control with Format Buttons -->
        <div class="font-controls">
            <label for="fontSizeInput" class="font-label">Font Size:</label>
            <input type="number" id="fontSizeInput" class="font-size-input" value="12" min="6" max="72" step="1" />
            <span class="font-unit">pt</span>
            <div class="format-buttons">
                <button class="format-btn bold-btn" title="Bold (Ctrl+B)">
                    <strong>B</strong>
                </button>
            </div>
        </div>

        <!-- Button Panel with Tabs -->
        <div class="tab-panel">
            <div class="tab-nav-container">
                <button class="tab-scroll-btn tab-scroll-left" id="tabScrollLeft">
                    <svg width="8" height="12" viewBox="0 0 8 8">
                        <path d="M8 2 L4 6 L8 10" stroke="currentColor" fill="none" stroke-width="1.5"/>
                    </svg>
                </button>
                <div class="tab-nav" id="tabNav">
                    <button class="tab-btn active" data-tab="structures">Structures</button>
                    <button class="tab-btn" data-tab="brackets">Brackets</button>
                    <button class="tab-btn" data-tab="operators">Operators</button>
                </div>
                <button class="tab-scroll-btn tab-scroll-right" id="tabScrollRight">
                    <svg width="12" height="12" viewBox="0 0 12 12">
                        <path d="M4 2 L8 6 L4 10" stroke="currentColor" fill="none" stroke-width="1.5"/>
                    </svg>
                </button>
            </div>
            <div class="tab-content">
                <div id="structures" class="tab-pane active">
                    <div class="button-row">
                        <button class="builder-btn fraction-btn" title="Fraction">
                            <math>
                                <mfrac>
                                    <mi>□</mi>
                                    <mi>□</mi>
                                </mfrac>
                            </math>
                        </button>
                        <button class="builder-btn bevelled-fraction-btn" title="Bevelled Fraction">
                            <math>
                                <mi>□</mi>
                                <mo>/</mo>
                                <mi>□</mi>
                            </math>
                        </button>
                        <button class="builder-btn sqrt-btn" title="Square Root">
                            <math>
                                <msqrt>
                                    <mi>□</mi>
                                </msqrt>
                            </math>
                        </button>
                        <button class="builder-btn nthroot-btn" title="Root">
                            <math>
                                <mroot>
                                    <mi>□</mi>
                                    <mi>□</mi>
                                </mroot>
                            </math>
                        </button>
                        <button class="builder-btn sup-btn" title="Superscript">
                            <math>
                                <msup>
                                    <mi>□</mi>
                                    <mi>□</mi>
                                </msup>
                            </math>
                        </button>
                        <button class="builder-btn sub-btn" title="Subscript">
                            <math>
                                <msub>
                                    <mi>□</mi>
                                    <mi>□</mi>
                                </msub>
                            </math>
                        </button>
                        <button class="builder-btn sup-sub-btn" title="Superscript-Subscript">
                            <math>
                                <msubsup>
                                    <mi>□</mi>
                                    <mi>□</mi>
                                    <mi>□</mi>
                                </msubsup>
                            </math>
                        </button>
                    </div>
                </div>
                <div id="brackets" class="tab-pane">
                    <div class="bracket-builder">
                        <div class="bracket-component">
                            <select id="leftBracketSelect" class="bracket-select">
                                <option value=""></option>
                                <option value="(" selected>(</option>
                                <option value="[">[</option>
                                <option value="{">{</option>
                                <option value="⌊">⌊</option>
                                <option value="⌈">⌈</option>
                                <option value="|">|</option>
                                <option value="‖">‖</option>
                                <option value="⟨">⟨</option>
                            </select>
                        </div>
                        
                        <div class="bracket-component bracket-input">
                            <div class="bracket-input-display">□</div>
                        </div>
                        
                        <div class="bracket-component">
                            <select id="rightBracketSelect" class="bracket-select">
                                <option value=""></option>
                                <option value=")" selected>)</option>
                                <option value="]">]</option>
                                <option value="}">}</option>
                                <option value="⌋">⌋</option>
                                <option value="⌉">⌉</option>
                                <option value="|">|</option>
                                <option value="‖">‖</option>
                                <option value="⟩">⟩</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="bracket-actions">
                        <button id="insertCustomBracket" class="builder-btn custom-bracket-btn">Insert Bracket(s)</button>
                    </div>
                </div>
                <div id="operators" class="tab-pane">
                    <div class="button-row">
                        <button class="builder-btn operator-btn" data-operator="\times"><math><mo>×</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\div"><math><mo>÷</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\pm"><math><mo>±</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\mp"><math><mo>∓</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\cdot"><math><mo>·</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\ast"><math><mo>∗</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\star"><math><mo>⋆</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\circ"><math><mo>∘</mo></math></button>
                    </div>
                    <div class="button-row">
                        <button class="builder-btn operator-btn" data-operator="\bullet"><math><mo>•</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\neq"><math><mo>≠</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\sim"><math><mo>∼</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\simeq"><math><mo>≃</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\approx"><math><mo>≈</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\equiv"><math><mo>≡</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\cong"><math><mo>≅</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\ncong"><math><mo>≇</mo></math></button>
                    </div>
                    <div class="button-row">
                        <button class="builder-btn operator-btn" data-operator="\propto"><math><mo>∝</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\leq"><math><mo>≤</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\geq"><math><mo>≥</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\nless"><math><mo>≮</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\ngtr"><math><mo>≯</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\nleq"><math><mo>≰</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\ngeq"><math><mo>≱</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\prec"><math><mo>≺</mo></math></button>
                    </div>
                    <div class="button-row">
                        <button class="builder-btn operator-btn" data-operator="\succ"><math><mo>≻</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\preceq"><math><mo>⪯</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\succeq"><math><mo>⪰</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\ll"><math><mo>≪</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\gg"><math><mo>≫</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\cap"><math><mo>∩</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\cup"><math><mo>∪</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\setminus"><math><mo>∖</mo></math></button>
                    </div>
                    <div class="button-row">
                        <button class="builder-btn operator-btn" data-operator="\in"><math><mo>∈</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\ni"><math><mo>∋</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\notin"><math><mo>∉</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\subset"><math><mo>⊂</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\supset"><math><mo>⊃</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\subseteq"><math><mo>⊆</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\supseteq"><math><mo>⊇</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\nsubseteq"><math><mo>⊈</mo></math></button>
                    </div>
                    <div class="button-row">
                        <button class="builder-btn operator-btn" data-operator="\nsupseteq"><math><mo>⊉</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\subsetneq"><math><mo>⊊</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\supsetneq"><math><mo>⊋</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\oplus"><math><mo>⊕</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\ominus"><math><mo>⊖</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\otimes"><math><mo>⊗</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\oslash"><math><mo>⊘</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\odot"><math><mo>⊙</mo></math></button>
                    </div>
                    <div class="button-row">
                        <button class="builder-btn operator-btn" data-operator="\triangleleft"><math><mo>◁</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\triangleright"><math><mo>▷</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\wr"><math><mo>≀</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\wedge"><math><mo>∧</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\vee"><math><mo>∨</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\vdash"><math><mo>⊢</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\models"><math><mo>⊨</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\top"><math><mo>⊤</mo></math></button>
                    </div>
                    <div class="button-row">
                        <button class="builder-btn operator-btn" data-operator="\bot"><math><mo>⊥</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\bowtie"><math><mo>⋈</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\diamond"><math><mo>⋄</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\asymp"><math><mo>≍</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\triangleq"><math><mo>≜</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\therefore"><math><mo>∴</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\because"><math><mo>∵</mo></math></button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Container for the action buttons and status messages -->
        <div class="footer">
            <div class="footer-controls">
                <button id="clear-equation-button" class="ms-Button ms-Button--secondary">
                    <span class="ms-Button-label">Clear</span>
                </button>
                <button id="insert-equation-button" class="ms-Button ms-Button--primary">
                    <span class="ms-Button-label">Insert Equation</span>
                </button>
            </div>
            <div id="status"></div>
        </div>
        
        <!-- Hidden container for MathJax rendering -->
        <div id="mathjax-renderer"></div>
    </div>
</body>

</html>