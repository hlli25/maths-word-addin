<!-- Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT License. -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Equation Editor</title>

    <!-- Office JavaScript API (Preview version for font.position support) -->
    <script type="text/javascript" src="https://appsforoffice.microsoft.com/lib/beta/hosted/office.js"></script>

    <!-- For more information on Fluent UI, visit https://developer.microsoft.com/fluentui#/. -->
    <link rel="stylesheet" href="https://res-1.cdn.office.net/files/fabric-cdn-prod_20230815.002/office-ui-fabric-core/11.1.0/css/fabric.min.css"/>

    <!-- Template styles -->
    <link href="taskpane.css" rel="stylesheet" type="text/css" />

    <!-- MathJax configuration and loading -->
    <script>
        window.MathJax = {
            loader: {load: ['[tex]/boldsymbol', '[tex]/color', '[tex]/physics']},
            tex: {
                packages: {'[+]': ['base', 'boldsymbol', 'color', 'ams', 'physics']},
                physics: {
                    italicdiff: false,  // Use upright 'd' for differentials
                    arrowdel: false     // Don't use arrow for derivatives
                },
                macros: {
                    // Custom derivative commands that render as fractions
                    derivfrac: ['\\frac{#1}{#2}', 2],
                    derivdfrac: ['\\dfrac{#1}{#2}', 2],
                    // Custom long form derivative commands (italic d style)
                    derivlfrac: ['\\frac{#1}{#2} #3', 3],    // d/dx f (inline)
                    derivldfrac: ['\\dfrac{#1}{#2} #3', 3],  // d/dx f (display)
                    // Custom macro for marking the function in long form derivatives
                    grande: ['#1', 1],  // Simply passes through the content
                    
                    // Custom integral commands with separate integrand and variable blocks
                    // Indefinite integrals (2 parameters)
                    // Single integral with italic d (standard LaTeX style)
                    inti: ['\\int {#1} \\, d{#2}', 2],
                    // Single integral with roman d (physics package style)
                    intd: ['\\int {#1} \\, \\dd{#2}', 2],
                    
                    // Double integral with italic d
                    iinti: ['\\iint {#1} \\, d{#2}', 2],
                    // Double integral with roman d
                    iintd: ['\\iint {#1} \\, \\dd{#2}', 2],
                    
                    // Triple integral with italic d
                    iiinti: ['\\iiint {#1} \\, d{#2}', 2],
                    // Triple integral with roman d
                    iiintd: ['\\iiint {#1} \\, \\dd{#2}', 2],
                    
                    // Contour integral with italic d
                    ointi: ['\\oint {#1} \\, d{#2}', 2],
                    // Contour integral with roman d
                    ointd: ['\\oint {#1} \\, \\dd{#2}', 2],
                    
                    // Definite integrals with limits (4 parameters: integrand, variable, lower, upper)
                    // Single definite integral with italic d
                    intil: ['\\int_{#3}^{#4} {#1} \\, d{#2}', 4],
                    // Single definite integral with roman d
                    intdl: ['\\int_{#3}^{#4} {#1} \\, \\dd{#2}', 4],
                    
                    // Double definite integral with italic d
                    iintil: ['\\iint_{#3}^{#4} {#1} \\, d{#2}', 4],
                    // Double definite integral with roman d
                    iintdl: ['\\iint_{#3}^{#4} {#1} \\, \\dd{#2}', 4],
                    
                    // Triple definite integral with italic d
                    iiintil: ['\\iiint_{#3}^{#4} {#1} \\, d{#2}', 4],
                    // Triple definite integral with roman d
                    iiintdl: ['\\iiint_{#3}^{#4} {#1} \\, \\dd{#2}', 4],
                    
                    // Contour definite integral with italic d
                    ointil: ['\\oint_{#3}^{#4} {#1} \\, d{#2}', 4],
                    // Contour definite integral with roman d
                    ointdl: ['\\oint_{#3}^{#4} {#1} \\, \\dd{#2}', 4]
                },
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            },
            svg: {
                fontCache: 'local',
                scale: 1,
                minScale: 0.5,
                displayIndent: '0',
                mtextInheritFont: true, // Allow text elements to inherit the surrounding font
                unknownFamily: 'serif'
            },
            startup: {
                ready: () => {
                    MathJax.startup.defaultReady();
                    MathJax.startup.document.updateDocument();
                }
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
</head>

<body class="ms-font-m">
    <div id="app-container">
        <h1 class="ms-fontSize-xl ms-fontWeight-bold">Equation Editor</h1>
        <p class="ms-fontSize-m ms-fontWeight-regular">Build your equation using the visual editor below.</p>
        
        <!-- Equation Builder Display -->
        <div class="equation-display equation-container" id="equationDisplay" data-context-path="root">
            <span class="empty-state">Click here and start typing your equation</span>
        </div>
        <input type="text" class="equation-input" id="hiddenInput" />


        <!-- Format Controls -->
        <div class="font-controls">
            <!-- Font Size Combobox -->
            <div class="control-group">
                <div class="font-size-container">
                    <div class="font-size-combobox">
                        <input type="text" id="fontSizeInput" class="font-size-input" value="12" />
                        <button class="font-size-dropdown-btn" id="fontSizeDropdownBtn" type="button">
                            <span class="dropdown-arrow">▼</span>
                        </button>
                        <div class="font-size-dropdown" id="fontSizeDropdown">
                            <div class="font-size-option" data-size="8">8</div>
                            <div class="font-size-option" data-size="9">9</div>
                            <div class="font-size-option" data-size="10">10</div>
                            <div class="font-size-option" data-size="11">11</div>
                            <div class="font-size-option" data-size="12">12</div>
                            <div class="font-size-option" data-size="14">14</div>
                            <div class="font-size-option" data-size="16">16</div>
                            <div class="font-size-option" data-size="18">18</div>
                            <div class="font-size-option" data-size="20">20</div>
                            <div class="font-size-option" data-size="24">24</div>
                            <div class="font-size-option" data-size="28">28</div>
                            <div class="font-size-option" data-size="32">32</div>
                            <div class="font-size-option" data-size="36">36</div>
                            <div class="font-size-option" data-size="48">48</div>
                            <div class="font-size-option" data-size="72">72</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Format Buttons -->
            <div class="format-buttons">
                <button class="format-btn bold-btn" id="boldBtn" title="Bold (Ctrl+B)">
                    <strong>B</strong>
                </button>
                <button class="format-btn italic-btn" id="italicBtn" title="Italic (Ctrl+I)">
                    <em>I</em>
                </button>
                <div class="underline-dropdown-container">
                    <button class="format-btn underline-btn" id="underlineBtn" title="Underline">
                        <span style="text-decoration: underline;">U</span>
                    </button>
                    <button class="format-btn underline-dropdown-btn" id="underlineDropdownBtn" title="More Underline Styles">
                        <span class="dropdown-arrow">▼</span>
                    </button>
                    <div class="underline-dropdown" id="underlineDropdown">
                        <div class="underline-option" data-underline="single">
                            <span class="underline-visual single-line">_____________</span>
                        </div>
                        <div class="underline-option" data-underline="double">
                            <span class="underline-visual double-line">_____________</span>
                        </div>
                        <div class="underline-option" data-underline="none">None</div>
                    </div>
                </div>
                <button class="format-btn cancel-btn" id="cancelBtn" title="Cancel">
                    <span class="cancel-icon">S</span>
                </button>
                <div class="color-dropdown-container">
                    <button class="format-btn color-btn" id="colorBtn" title="Text Color">
                        <span class="color-icon">A</span>
                        <div class="color-preview" id="colorPreview"></div>
                    </button>
                    <button class="format-btn color-dropdown-btn" id="colorDropdownBtn" title="More Colors">
                        <span class="dropdown-arrow">▼</span>
                    </button>
                    <div class="color-panel" id="colorPanel">
                        <div class="color-grid">
                            <!-- Row 1 - Grayscale -->
                            <div class="color-row">
                                <div class="color-square" data-color="#000000" style="background-color: #000000;" title="Black"></div>
                                <div class="color-square" data-color="#434343" style="background-color: #434343;" title="Dark Gray 4"></div>
                                <div class="color-square" data-color="#666666" style="background-color: #666666;" title="Dark Gray 3"></div>
                                <div class="color-square" data-color="#999999" style="background-color: #999999;" title="Dark Gray 2"></div>
                                <div class="color-square" data-color="#B7B7B7" style="background-color: #B7B7B7;" title="Dark Gray 1"></div>
                                <div class="color-square" data-color="#CCCCCC" style="background-color: #CCCCCC;" title="Gray"></div>
                                <div class="color-square" data-color="#D9D9D9" style="background-color: #D9D9D9;" title="Light Gray 1"></div>
                                <div class="color-square" data-color="#EFEFEF" style="background-color: #EFEFEF;" title="Light Gray 2"></div>
                                <div class="color-square" data-color="#F3F3F3" style="background-color: #F3F3F3;" title="Light Gray 3"></div>
                                <div class="color-square" data-color="#FFFFFF" style="background-color: #FFFFFF; border: 1px solid #ccc;" title="White"></div>
                            </div>
                            <!-- Row 2 - Bright Colors -->
                            <div class="color-row">
                                <div class="color-square" data-color="#980000" style="background-color: #980000;" title="Dark Red"></div>
                                <div class="color-square" data-color="#FF0000" style="background-color: #FF0000;" title="Red"></div>
                                <div class="color-square" data-color="#FF9900" style="background-color: #FF9900;" title="Orange"></div>
                                <div class="color-square" data-color="#FFFF00" style="background-color: #FFFF00;" title="Yellow"></div>
                                <div class="color-square" data-color="#00FF00" style="background-color: #00FF00;" title="Green"></div>
                                <div class="color-square" data-color="#00FFFF" style="background-color: #00FFFF;" title="Cyan"></div>
                                <div class="color-square" data-color="#4A86E8" style="background-color: #4A86E8;" title="Light Blue"></div>
                                <div class="color-square" data-color="#0000FF" style="background-color: #0000FF;" title="Blue"></div>
                                <div class="color-square" data-color="#9900FF" style="background-color: #9900FF;" title="Purple"></div>
                                <div class="color-square" data-color="#FF00FF" style="background-color: #FF00FF;" title="Magenta"></div>
                            </div>
                            <!-- Row 3 - Dark Colors -->
                            <div class="color-row">
                                <div class="color-square" data-color="#85200C" style="background-color: #85200C;" title="Dark Red 2"></div>
                                <div class="color-square" data-color="#990000" style="background-color: #990000;" title="Dark Red 3"></div>
                                <div class="color-square" data-color="#B45F06" style="background-color: #B45F06;" title="Dark Orange"></div>
                                <div class="color-square" data-color="#BF9000" style="background-color: #BF9000;" title="Dark Yellow"></div>
                                <div class="color-square" data-color="#38761D" style="background-color: #38761D;" title="Dark Green"></div>
                                <div class="color-square" data-color="#134F5C" style="background-color: #134F5C;" title="Dark Cyan"></div>
                                <div class="color-square" data-color="#1155CC" style="background-color: #1155CC;" title="Dark Blue 1"></div>
                                <div class="color-square" data-color="#0B5394" style="background-color: #0B5394;" title="Dark Blue 2"></div>
                                <div class="color-square" data-color="#351C75" style="background-color: #351C75;" title="Dark Purple"></div>
                                <div class="color-square" data-color="#741B47" style="background-color: #741B47;" title="Dark Magenta"></div>
                            </div>
                        </div>
                        <div class="hex-input-section">
                            <div class="hex-input-row">
                                <label for="hexInput">Hex code:</label>
                                <div class="hex-input-container">
                                    <input type="text" id="hexInput" class="hex-input" value="#000000" maxlength="7" placeholder="#000000" />
                                    <div class="hex-color-preview" id="hexColorPreview"></div>
                                </div>
                            </div>
                            <div class="hex-actions">
                                <button class="hex-btn hex-ok-btn" id="colorOkBtn">OK</button>
                                <button class="hex-btn hex-cancel-btn" id="colorCancelBtn">Cancel</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="format-separator"></div>
                <button class="format-btn text-mode-btn" id="textModeBtn" title="Text Mode">
                    <span class="text-mode-icon">Tt</span>
                </button>
            </div>
        </div>

        <!-- Button Panel with Tabs -->
        <div class="tab-panel">
            <div class="tab-nav-container">
                <button class="tab-scroll-btn tab-scroll-left" id="tabScrollLeft">
                    <svg width="8" height="12" viewBox="0 0 8 8">
                        <path d="M8 2 L4 6 L8 10" stroke="currentColor" fill="none" stroke-width="1.5"/>
                    </svg>
                </button>
                <div class="tab-nav" id="tabNav">
                    <button class="tab-btn active" data-tab="structures">Structures</button>
                    <button class="tab-btn" data-tab="brackets">Brackets</button>
                    <button class="tab-btn" data-tab="operators">Operators</button>
                    <button class="tab-btn" data-tab="large-operators">Large Operators</button>
                    <button class="tab-btn" data-tab="calculus">Calculus</button>
                    <button class="tab-btn" data-tab="greek-letters">Greek Letters</button>
                    <button class="tab-btn" data-tab="accents">Accents</button>
                    <button class="tab-btn" data-tab="arrows">Arrows</button>
                    <button class="tab-btn" data-tab="matrices">Matrices</button>
                </div>
                <button class="tab-scroll-btn tab-scroll-right" id="tabScrollRight">
                    <svg width="12" height="12" viewBox="0 0 12 12">
                        <path d="M4 2 L8 6 L4 10" stroke="currentColor" fill="none" stroke-width="1.5"/>
                    </svg>
                </button>
            </div>
            <div class="tab-content">
                <div id="structures" class="tab-pane active">
                    <div class="button-row">
                        <button class="builder-btn display-fraction-btn" title="Fraction">
                            <math displaystyle="true">
                                <mfrac>
                                    <mi>□</mi>
                                    <mi>□</mi>
                                </mfrac>
                            </math>
                        </button>
                        <button class="builder-btn fraction-btn" title="Fraction (Small)">
                            <math>
                                <mfrac>
                                    <mi>□</mi>
                                    <mi>□</mi>
                                </mfrac>
                            </math>
                        </button>
                        <button class="builder-btn bevelled-fraction-btn" title="Bevelled Fraction">
                            <math>
                                <mi>□</mi>
                                <mo>/</mo>
                                <mi>□</mi>
                            </math>
                        </button>
                        <button class="builder-btn sqrt-btn" title="Square Root">
                            <math>
                                <msqrt>
                                    <mi>□</mi>
                                </msqrt>
                            </math>
                        </button>
                        <button class="builder-btn nthroot-btn" title="Root">
                            <math>
                                <mroot>
                                    <mi>□</mi>
                                    <mi>□</mi>
                                </mroot>
                            </math>
                        </button>
                        <button class="builder-btn sup-btn" title="Superscript">
                            <math>
                                <msup>
                                    <mi>□</mi>
                                    <mi>□</mi>
                                </msup>
                            </math>
                        </button>
                        <button class="builder-btn sub-btn" title="Subscript">
                            <math>
                                <msub>
                                    <mi>□</mi>
                                    <mi>□</mi>
                                </msub>
                            </math>
                        </button>
                        <button class="builder-btn sup-sub-btn" title="Superscript-Subscript">
                            <math>
                                <msubsup>
                                    <mi>□</mi>
                                    <mi>□</mi>
                                    <mi>□</mi>
                                </msubsup>
                            </math>
                        </button>
                    </div>
                    <hr class="horizontal-separator">
                    <!-- Row 1: 1-Column Stacks and Cases -->
                    <div class="button-row">
                        <button class="builder-btn stack-btn" data-stack="2x1" title="Stack 2×1">
                            <math><mtable><mtr><mtd><mi>□</mi></mtd></mtr><mtr><mtd><mi>□</mi></mtd></mtr></mtable></math>
                        </button>
                        <button class="builder-btn stack-btn" data-stack="3x1" title="Stack 3×1">
                            <math><mtable><mtr><mtd><mi>□</mi></mtd></mtr><mtr><mtd><mi>□</mi></mtd></mtr><mtr><mtd><mi>□</mi></mtd></mtr></mtable></math>
                        </button>
                        <button class="builder-btn stack-btn" data-stack="nx1" title="Stack n×1">
                            <math><mtable><mtr><mtd><mi>□</mi></mtd></mtr><mtr><mtd><mo>⋮</mo></mtd></mtr><mtr><mtd><mi>□</mi></mtd></mtr></mtable></math>
                        </button>
                        <button class="builder-btn cases-btn" data-cases="2x1" title="Cases 2×1">
                            <math><mrow><mo stretchy="true">{</mo><mtable><mtr><mtd><mi>□</mi></mtd></mtr><mtr><mtd><mi>□</mi></mtd></mtr></mtable></mrow></math>
                        </button>
                        <button class="builder-btn cases-btn" data-cases="3x1" title="Cases 3×1">
                            <math><mrow><mo stretchy="true">{</mo><mtable><mtr><mtd><mi>□</mi></mtd></mtr><mtr><mtd><mi>□</mi></mtd></mtr><mtr><mtd><mi>□</mi></mtd></mtr></mtable></mrow></math>
                        </button>
                        <button class="builder-btn cases-btn" data-cases="nx1" title="Cases n×1">
                            <math><mrow><mo stretchy="true">{</mo><mtable><mtr><mtd><mi>□</mi></mtd></mtr><mtr><mtd><mo>⋮</mo></mtd></mtr><mtr><mtd><mi>□</mi></mtd></mtr></mtable></mrow></math>
                        </button>
                    </div>
                    <!-- Row 2: 2-Column Stacks and Cases -->
                    <div class="button-row">
                        <button class="builder-btn stack-btn" data-stack="2x2" title="Stack 2×2">
                            <math><mtable><mtr><mtd><mi>□</mi></mtd><mtd><mi>□</mi></mtd></mtr><mtr><mtd><mi>□</mi></mtd><mtd><mi>□</mi></mtd></mtr></mtable></math>
                        </button>
                        <button class="builder-btn stack-btn" data-stack="3x2" title="Stack 3×2">
                            <math><mtable><mtr><mtd><mi>□</mi></mtd><mtd><mi>□</mi></mtd></mtr><mtr><mtd><mi>□</mi></mtd><mtd><mi>□</mi></mtd></mtr><mtr><mtd><mi>□</mi></mtd><mtd><mi>□</mi></mtd></mtr></mtable></math>
                        </button>
                        <button class="builder-btn stack-btn" data-stack="nx2" title="Stack n×2">
                            <math><mtable><mtr><mtd><mi>□</mi></mtd><mtd><mi>□</mi></mtd></mtr><mtr><mtd><mo>⋮</mo></mtd><mtd><mo>⋮</mo></mtd></mtr><mtr><mtd><mi>□</mi></mtd><mtd><mi>□</mi></mtd></mtr></mtable></math>
                        </button>
                        <button class="builder-btn cases-btn" data-cases="2x2" title="Cases 2×2">
                            <math><mrow><mo stretchy="true">{</mo><mtable><mtr><mtd><mi>□</mi></mtd><mtd><mi>□</mi></mtd></mtr><mtr><mtd><mi>□</mi></mtd><mtd><mi>□</mi></mtd></mtr></mtable></mrow></math>
                        </button>
                        <button class="builder-btn cases-btn" data-cases="3x2" title="Cases 3×2">
                            <math><mrow><mo stretchy="true">{</mo><mtable><mtr><mtd><mi>□</mi></mtd><mtd><mi>□</mi></mtd></mtr><mtr><mtd><mi>□</mi></mtd><mtd><mi>□</mi></mtd></mtr><mtr><mtd><mi>□</mi></mtd><mtd><mi>□</mi></mtd></mtr></mtable></mrow></math>
                        </button>
                        <button class="builder-btn cases-btn" data-cases="nx2" title="Cases n×2">
                            <math><mrow><mo stretchy="true">{</mo><mtable><mtr><mtd><mi>□</mi></mtd><mtd><mi>□</mi></mtd></mtr><mtr><mtd><mo>⋮</mo></mtd><mtd><mo>⋮</mo></mtd></mtr><mtr><mtd><mi>□</mi></mtd><mtd><mi>□</mi></mtd></mtr></mtable></mrow></math>
                        </button>
                    </div>
                </div>
                <div id="brackets" class="tab-pane">
                    <div class="builder-grid">
                        <button class="builder-btn bracket-preset-btn" data-bracket="()" title="Parentheses">(□)</button>
                        <button class="builder-btn bracket-preset-btn" data-bracket="[]" title="Square Brackets">[□]</button>
                        <button class="builder-btn bracket-preset-btn" data-bracket="{}" title="Curly Brackets">{□}</button>
                        <button class="builder-btn bracket-preset-btn" data-bracket="⌊⌋" title="Floor Brackets">⌊□⌋</button>
                        <button class="builder-btn bracket-preset-btn" data-bracket="⌈⌉" title="Ceiling Brackets">⌈□⌉</button>
                        <button class="builder-btn bracket-preset-btn" data-bracket="||" title="Absolute Value">|□|</button>
                        <button class="builder-btn bracket-preset-btn" data-bracket="‖‖" title="Norm">‖□‖</button>
                        <button class="builder-btn bracket-preset-btn" data-bracket="⟨⟩" title="Angle Brackets">⟨□⟩</button>
                    </div>
                    <hr class="bracket-separator">
                    <div class="bracket-builder">
                        <div class="bracket-left-section">
                            <div class="bracket-component">
                                <select id="leftBracketSelect" class="bracket-select">
                                    <option value="(" selected>(</option>
                                    <option value="[">[</option>
                                    <option value="{">{</option>
                                    <option value="⌊">⌊</option>
                                    <option value="⌈">⌈</option>
                                    <option value="|">|</option>
                                    <option value="‖">‖</option>
                                    <option value="⟨">⟨</option>
                                </select>
                            </div>
                            
                            <div class="bracket-component bracket-input">
                                <div class="bracket-input-display">□</div>
                            </div>
                            
                            <div class="bracket-component">
                                <select id="rightBracketSelect" class="bracket-select">
                                    <option value=")" selected>)</option>
                                    <option value="]">]</option>
                                    <option value="}">}</option>
                                    <option value="⌋">⌋</option>
                                    <option value="⌉">⌉</option>
                                    <option value="|">|</option>
                                    <option value="‖">‖</option>
                                    <option value="⟩">⟩</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="bracket-actions">
                            <button id="insertCustomBracket" class="builder-btn custom-bracket-btn">Insert<br>Brackets</button>
                        </div>
                    </div>
                </div>
                <div id="operators" class="tab-pane">
                    <div class="button-row">
                        <button class="builder-btn operator-btn" data-operator="\times"><math><mo>×</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\divsymbol"><math><mo>÷</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\pm"><math><mo>±</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\mp"><math><mo>∓</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\cdot"><math><mo>·</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\ast"><math><mo>∗</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\star"><math><mo>⋆</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\circ"><math><mo>∘</mo></math></button>
                    </div>
                    <div class="button-row">
                        <button class="builder-btn operator-btn" data-operator="\bullet"><math><mo>•</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\neq"><math><mo>≠</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\sim"><math><mo>∼</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\simeq"><math><mo>≃</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\approx"><math><mo>≈</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\equiv"><math><mo>≡</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\cong"><math><mo>≅</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\ncong"><math><mo>≇</mo></math></button>
                    </div>
                    <div class="button-row">
                        <button class="builder-btn operator-btn" data-operator="\propto"><math><mo>∝</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\leq"><math><mo>≤</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\geq"><math><mo>≥</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\nless"><math><mo>≮</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\ngtr"><math><mo>≯</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\nleq"><math><mo>≰</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\ngeq"><math><mo>≱</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\prec"><math><mo>≺</mo></math></button>
                    </div>
                    <div class="button-row">
                        <button class="builder-btn operator-btn" data-operator="\succ"><math><mo>≻</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\preceq"><math><mo>⪯</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\succeq"><math><mo>⪰</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\ll"><math><mo>≪</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\gg"><math><mo>≫</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\cap"><math><mo>∩</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\cup"><math><mo>∪</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\setminus"><math><mo>∖</mo></math></button>
                    </div>
                    <div class="button-row">
                        <button class="builder-btn operator-btn" data-operator="\in"><math><mo>∈</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\ni"><math><mo>∋</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\notin"><math><mo>∉</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\subset"><math><mo>⊂</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\supset"><math><mo>⊃</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\subseteq"><math><mo>⊆</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\supseteq"><math><mo>⊇</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\nsubseteq"><math><mo>⊈</mo></math></button>
                    </div>
                    <div class="button-row">
                        <button class="builder-btn operator-btn" data-operator="\nsupseteq"><math><mo>⊉</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\subsetneq"><math><mo>⊊</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\supsetneq"><math><mo>⊋</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\oplus"><math><mo>⊕</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\ominus"><math><mo>⊖</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\otimes"><math><mo>⊗</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\oslash"><math><mo>⊘</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\odot"><math><mo>⊙</mo></math></button>
                    </div>
                    <div class="button-row">
                        <button class="builder-btn operator-btn" data-operator="\triangleleft"><math><mo>◁</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\triangleright"><math><mo>▷</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\wr"><math><mo>≀</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\wedge"><math><mo>∧</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\vee"><math><mo>∨</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\vdash"><math><mo>⊢</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\models"><math><mo>⊨</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\top"><math><mo>⊤</mo></math></button>
                    </div>
                    <div class="button-row">
                        <button class="builder-btn operator-btn" data-operator="\bot"><math><mo>⊥</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\bowtie"><math><mo>⋈</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\diamond"><math><mo>⋄</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\asymp"><math><mo>≍</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\triangleq"><math><mo>≜</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\therefore"><math><mo>∴</mo></math></button>
                        <button class="builder-btn operator-btn" data-operator="\because"><math><mo>∵</mo></math></button>
                    </div>
                </div>
                <div id="large-operators" class="tab-pane">
                    <div class="button-row">
                        <button class="builder-btn large-operator-btn sum-display-nolimit-btn" title="Summation (Side limits) (Large)">
                            <math displaystyle="true">
                                <mrow>
                                    <msubsup>
                                        <mo class="sum-operator-display">∑</mo>
                                        <mi class="sum-limit-display">□</mi>
                                        <mi class="sum-limit-display">□</mi>
                                    </msubsup>
                                    <mi class="sum-operand-display">□</mi>
                                </mrow>
                            </math>
                        </button>
                        <button class="builder-btn large-operator-btn sum-display-limit-btn" title="Summation (Above/Below limits) (Large)">
                            <math displaystyle="true">
                                <mrow>
                                    <munderover>
                                        <mo class="sum-operator-display">∑</mo>
                                        <mi class="sum-limit-display">□</mi>
                                        <mi class="sum-limit-display">□</mi>
                                    </munderover>
                                    <mi class="sum-operand-display">□</mi>
                                </mrow>
                            </math>
                        </button>
                        <button class="builder-btn large-operator-btn sum-nolimit-btn" title="Summation (Side limits) (Small)">
                            <math>
                                <mrow>
                                    <msubsup>
                                        <mo class="sum-operator-inline">∑</mo>
                                        <mi class="sum-limit-inline">□</mi>
                                        <mi class="sum-limit-inline">□</mi>
                                    </msubsup>
                                    <mi class="sum-operand-inline">□</mi>
                                </mrow>
                            </math>
                        </button>
                        <button class="builder-btn large-operator-btn sum-limit-btn" title="Summation (Above/Below limits) (Small)">
                            <math>
                                <mrow>
                                    <munderover>
                                        <mo class="sum-operator-inline" movablelimits="false">∑</mo>
                                        <mi class="sum-limit-inline">□</mi>
                                        <mi class="sum-limit-inline">□</mi>
                                    </munderover>
                                    <mi class="sum-operand-inline">□</mi>
                                </mrow>
                            </math>
                        </button>
                    </div>
                    <div class="button-row">
                        <button class="builder-btn large-operator-btn prod-display-nolimit-btn" title="Product (Side limits) (Large)">
                            <math displaystyle="true">
                                <mrow>
                                    <msubsup>
                                        <mo class="sum-operator-display">∏</mo>
                                        <mi class="sum-limit-display">□</mi>
                                        <mi class="sum-limit-display">□</mi>
                                    </msubsup>
                                    <mi class="sum-operand-display">□</mi>
                                </mrow>
                            </math>
                        </button>
                        <button class="builder-btn large-operator-btn prod-display-limit-btn" title="Product (Above/Below limits) (Large)">
                            <math displaystyle="true">
                                <mrow>
                                    <munderover>
                                        <mo class="sum-operator-display">∏</mo>
                                        <mi class="sum-limit-display">□</mi>
                                        <mi class="sum-limit-display">□</mi>
                                    </munderover>
                                    <mi class="sum-operand-display">□</mi>
                                </mrow>
                            </math>
                        </button>
                        <button class="builder-btn large-operator-btn prod-nolimit-btn" title="Product (Side limits) (Samll)">
                            <math>
                                <mrow>
                                    <msubsup>
                                        <mo class="sum-operator-inline">∏</mo>
                                        <mi class="sum-limit-inline">□</mi>
                                        <mi class="sum-limit-inline">□</mi>
                                    </msubsup>
                                    <mi class="sum-operand-inline">□</mi>
                                </mrow>
                            </math>
                        </button>
                        <button class="builder-btn large-operator-btn prod-limit-btn" title="Product (Above/Below limits) (Small)">
                            <math>
                                <mrow>
                                    <munderover>
                                        <mo class="sum-operator-inline" movablelimits="false">∏</mo>
                                        <mi class="sum-limit-inline">□</mi>
                                        <mi class="sum-limit-inline">□</mi>
                                    </munderover>
                                    <mi class="sum-operand-inline">□</mi>
                                </mrow>
                            </math>
                        </button>
                    </div>
                </div>
                <div id="calculus" class="tab-pane">
                    <!-- Differential style toggle buttons -->
                    <div class="button-row differential-style-row">
                        <button class="differential-style-btn active" id="differential-style-italic" title="Italic d (default)">
                            <math>
                                <mrow>
                                    <mi>d</mi>
                                    <mi>□</mi>
                                </mrow>
                            </math>
                        </button>
                        <button class="differential-style-btn" id="differential-style-roman" title="Roman d">
                            <math>
                                <mrow>
                                    <mtext>d</mtext>
                                    <mi>□</mi>
                                </mrow>
                            </math>
                        </button>
                        <div class="vertical-separator"></div>
                        <button class="display-style-toggle-btn" id="display-style-toggle" title="Display → Inline">
                            <math>
                                <mrow>
                                    <mo style="font-size: 18px;">∫</mo>
                                    <mo>→</mo>
                                    <mo style="font-size: 12px;">∫</mo>
                                </mrow>
                            </math>
                        </button>
                    </div>
                    <!-- Derivative buttons -->
                    <div class="button-row">
                        <button class="builder-btn derivative-btn first-derivative-btn" title="First derivative">
                            <math>
                                <mfrac>
                                    <mrow>
                                        <mi class="derivative-d">d</mi>
                                        <mi>□</mi>
                                    </mrow>
                                    <mrow>
                                        <mi class="derivative-d">d</mi>
                                        <mi>□</mi>
                                    </mrow>
                                </mfrac>
                            </math>
                        </button>
                        <button class="builder-btn derivative-btn nth-derivative-btn" title="Higher derivative">
                            <math>
                                <mfrac>
                                    <mrow>
                                        <msup>
                                            <mi class="derivative-d">d</mi>
                                            <mi>□</mi>
                                        </msup>
                                        <mi>□</mi>
                                    </mrow>
                                    <mrow>
                                        <mi class="derivative-d">d</mi>
                                        <msup>
                                            <mi>□</mi>
                                            <mi>□</mi>
                                        </msup>
                                    </mrow>
                                </mfrac>
                            </math>
                        </button>
                        <button class="builder-btn derivative-btn derivative-long-form-btn" title="Derivative (Long form)">
                            <math>
                                <mrow>
                                    <mfrac>
                                        <mi class="derivative-d">d</mi>
                                        <mrow>
                                            <mi class="derivative-d">d</mi>
                                            <mi>□</mi>
                                        </mrow>
                                    </mfrac>
                                    <mi>□</mi>
                                </mrow>
                            </math>
                        </button>
                        <button class="builder-btn derivative-btn nth-derivative-long-form-btn" title="Higher derivative (Long form)">
                            <math>
                                <mrow>
                                    <mfrac>
                                        <msup>
                                            <mi class="derivative-d">d</mi>
                                            <mi>□</mi>
                                        </msup>
                                        <mrow>
                                            <mi class="derivative-d">d</mi>
                                            <msup>
                                                <mi>□</mi>
                                                <mi>□</mi>
                                            </msup>
                                        </mrow>
                                    </mfrac>
                                    <mi>□</mi>
                                </mrow>
                            </math>
                        </button>
                    </div>
                    <!-- Integration buttons -->
                    <div class="button-row">
                        <button class="builder-btn integral-btn int-indefinite-display-btn" title="Indefinite integral">
                            <math displaystyle="true">
                                <mrow>
                                    <mo class="sum-operator-display">∫</mo>
                                    <mi class="sum-operand-display">□</mi>
                                    <mi class="derivative-d">d</mi>
                                    <mi>□</mi>
                                </mrow>
                            </math>
                        </button>
                        <button class="builder-btn integral-btn int-display-nolimit-btn" title="Definite integral (Side limits)">
                            <math displaystyle="true">
                                <mrow>
                                    <msubsup>
                                        <mo class="sum-operator-display">∫</mo>
                                        <mi class="sum-limit-display">□</mi>
                                        <mi class="sum-limit-display">□</mi>
                                    </msubsup>
                                    <mi class="sum-operand-display">□</mi>
                                    <mi class="derivative-d">d</mi>
                                    <mi>□</mi>
                                </mrow>
                            </math>
                        </button>
                        <button class="builder-btn integral-btn int-display-limit-btn" title="Definite integral (Above/Below limits)">
                            <math displaystyle="true">
                                <mrow>
                                    <munderover>
                                        <mo class="sum-operator-display">∫</mo>
                                        <mi class="sum-limit-display">□</mi>
                                        <mi class="sum-limit-display">□</mi>
                                    </munderover>
                                    <mi class="sum-operand-display">□</mi>
                                    <mi class="derivative-d">d</mi>
                                    <mi>□</mi>
                                </mrow>
                            </math>
                        </button>
                    </div>
                </div>
                <div id="greek-letters" class="tab-pane">
                    <!-- Small Greek Letters -->
                    <div class="button-row">
                        <button class="builder-btn greek-letter-btn" data-greek="\alpha" title="Alpha">α</button>
                        <button class="builder-btn greek-letter-btn" data-greek="\beta" title="Beta">β</button>
                        <button class="builder-btn greek-letter-btn" data-greek="\gamma" title="Gamma">γ</button>
                        <button class="builder-btn greek-letter-btn" data-greek="\delta" title="Delta">δ</button>
                        <button class="builder-btn greek-letter-btn" data-greek="\epsilon" title="Epsilon">ϵ</button>
                        <button class="builder-btn greek-letter-btn" data-greek="\varepsilon" title="Epsilon variant">ε</button>
                        <button class="builder-btn greek-letter-btn" data-greek="\zeta" title="Zeta">ζ</button>
                        <button class="builder-btn greek-letter-btn" data-greek="\eta" title="Eta">η</button>
                    </div>
                    <div class="button-row">
                        <button class="builder-btn greek-letter-btn" data-greek="\theta" title="Theta">θ</button>
                        <button class="builder-btn greek-letter-btn" data-greek="\vartheta" title="Theta variant">ϑ</button>
                        <button class="builder-btn greek-letter-btn" data-greek="\iota" title="Iota">ι</button>
                        <button class="builder-btn greek-letter-btn" data-greek="\kappa" title="Kappa">κ</button>
                        <button class="builder-btn greek-letter-btn" data-greek="\lambda" title="Lambda">λ</button>
                        <button class="builder-btn greek-letter-btn" data-greek="\mu" title="Mu">μ</button>
                        <button class="builder-btn greek-letter-btn" data-greek="\nu" title="Nu">ν</button>
                        <button class="builder-btn greek-letter-btn" data-greek="\xi" title="Xi">ξ</button>
                    </div>
                    <div class="button-row">
                        <button class="builder-btn greek-letter-btn" data-greek="\omicron" title="Omicron">ο</button>
                        <button class="builder-btn greek-letter-btn" data-greek="\pi" title="Pi">π</button>
                        <button class="builder-btn greek-letter-btn" data-greek="\varpi" title="Pi variant">ϖ</button>
                        <button class="builder-btn greek-letter-btn" data-greek="\rho" title="Rho">ρ</button>
                        <button class="builder-btn greek-letter-btn" data-greek="\varrho" title="Rho variant">ϱ</button>
                        <button class="builder-btn greek-letter-btn" data-greek="\sigma" title="Sigma">σ</button>
                        <button class="builder-btn greek-letter-btn" data-greek="\varsigma" title="Sigma variant">ς</button>
                        <button class="builder-btn greek-letter-btn" data-greek="\tau" title="Tau">τ</button>
                    </div>
                    <div class="button-row">
                        <button class="builder-btn greek-letter-btn" data-greek="\upsilon" title="Upsilon">υ</button>
                        <button class="builder-btn greek-letter-btn" data-greek="\phi" title="Phi">ϕ</button>
                        <button class="builder-btn greek-letter-btn" data-greek="\varphi" title="Phi variant">φ</button>
                        <button class="builder-btn greek-letter-btn" data-greek="\chi" title="Chi">χ</button>
                        <button class="builder-btn greek-letter-btn" data-greek="\psi" title="Psi">ψ</button>
                        <button class="builder-btn greek-letter-btn" data-greek="\omega" title="Omega">ω</button>
                    </div>
                    <hr class="horizontal-separator">
                    <!-- Capital Greek Letters -->
                    <div class="button-row">
                        <button class="builder-btn greek-letter-capital-btn" data-greek="\Gamma" title="Capital Gamma">Γ</button>
                        <button class="builder-btn greek-letter-capital-btn" data-greek="\Delta" title="Capital Delta">Δ</button>
                        <button class="builder-btn greek-letter-capital-btn" data-greek="\Theta" title="Capital Theta">Θ</button>
                        <button class="builder-btn greek-letter-capital-btn" data-greek="\Lambda" title="Capital Lambda">Λ</button>
                        <button class="builder-btn greek-letter-capital-btn" data-greek="\Pi" title="Capital Pi">Π</button>
                        <button class="builder-btn greek-letter-capital-btn" data-greek="\Sigma" title="Capital Sigma">Σ</button>
                        <button class="builder-btn greek-letter-capital-btn" data-greek="\Upsilon" title="Capital Upsilon">Υ</button>
                        <button class="builder-btn greek-letter-capital-btn" data-greek="\Phi" title="Capital Phi">Φ</button>
                    </div>
                    <div class="button-row">
                        <button class="builder-btn greek-letter-capital-btn" data-greek="\Psi" title="Capital Psi">Ψ</button>
                        <button class="builder-btn greek-letter-capital-btn" data-greek="\Omega" title="Capital Omega">Ω</button>
                    </div>
                </div>
                <div id="matrices" class="tab-pane">
                    <!-- Matrix Type Buttons -->
                    <div class="button-row">
                        <button class="builder-btn matrix-btn" data-matrix-type="parentheses" title="Parentheses Matrix">( )</button>
                        <button class="builder-btn matrix-btn" data-matrix-type="brackets" title="Brackets Matrix">[ ]</button>
                        <button class="builder-btn matrix-btn" data-matrix-type="braces" title="Braces Matrix">{ }</button>
                        <button class="builder-btn matrix-btn" data-matrix-type="bars" title="Bars Matrix">| |</button>
                        <button class="builder-btn matrix-btn" data-matrix-type="double-bars" title="Double Bars Matrix">∥ ∥</button>
                        <button class="builder-btn matrix-btn" data-matrix-type="none" title="Plain Matrix">□</button>
                    </div>
                    
                    <!-- Matrix Size Selection Panel (Initially Hidden) -->
                    <div class="matrix-size-panel" id="matrixSizePanel" style="display: none;">
                        <div class="matrix-size-header">Select Matrix Size</div>
                        
                        <div class="matrix-panel-content">
                            <!-- Left Side: Visual Grid Selector -->
                            <div class="matrix-panel-left">
                                <div class="matrix-grid-selector" id="matrixGridSelector">
                                    <!-- Grid will be generated dynamically -->
                                </div>
                                <div class="matrix-grid-hint">Quick select (up to 6×6)</div>
                            </div>
                            
                            <!-- Right Side: Manual Input and Actions -->
                            <div class="matrix-panel-right">
                                <div class="matrix-manual-input">
                                    <div class="matrix-input-row">
                                        <label for="matrixRows">Rows:</label>
                                        <input type="number" id="matrixRows" min="1" max="20" value="2" class="matrix-size-input">
                                    </div>
                                    <div class="matrix-input-row">
                                        <label for="matrixCols">Cols:</label>
                                        <input type="number" id="matrixCols" min="1" max="20" value="2" class="matrix-size-input">
                                    </div>
                                    <div class="matrix-input-hint">Supports up to 20×20</div>
                                    <div class="matrix-actions">
                                        <button id="createMatrixBtn" class="matrix-action-btn matrix-create-btn">Create</button>
                                        <button id="cancelMatrixBtn" class="matrix-action-btn matrix-cancel-btn">Cancel</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="accents" class="tab-pane">
                    <!-- Single-character accents -->
                    <div class="button-row">
                        <button class="builder-btn accent-btn" data-accent="hat" data-position="over" title="Hat">
                            <math><mover><mrow style="border: 1px solid #666; padding: 2px 4px;"><mi>x</mi></mrow><mo>^</mo></mover></math>
                        </button>
                        <button class="builder-btn accent-btn" data-accent="tilde" data-position="over" title="Tilde">
                            <math><mover><mrow style="border: 1px solid #666; padding: 2px 4px;"><mi>x</mi></mrow><mo>~</mo></mover></math>
                        </button>
                        <button class="builder-btn accent-btn" data-accent="bar" data-position="over" title="Bar">
                            <math><mover><mrow style="border: 1px solid #666; padding: 2px 4px;"><mi>x</mi></mrow><mo>‾</mo></mover></math>
                        </button>
                        <button class="builder-btn accent-btn" data-accent="dot" data-position="over" title="Dot">
                            <math><mover><mrow style="border: 1px solid #666; padding: 2px 4px;"><mi>x</mi></mrow><mo>·</mo></mover></math>
                        </button>
                        <button class="builder-btn accent-btn" data-accent="ddot" data-position="over" title="Double Dot">
                            <math><mover><mrow style="border: 1px solid #666; padding: 2px 4px;"><mi>x</mi></mrow><mo>¨</mo></mover></math>
                        </button>
                        <button class="builder-btn accent-btn" data-accent="vec" data-position="over" title="Vector">
                            <math><mover><mrow style="border: 1px solid #666; padding: 2px 4px;"><mi>x</mi></mrow><mo>→</mo></mover></math>
                        </button>
                    </div>
                    <!-- Wide accents -->
                    <div class="button-row">
                        <button class="builder-btn accent-btn" data-accent="widehat" data-position="over" title="Wide Hat">
                            <math><mover><mrow style="border: 1px solid #666; padding: 2px 4px; background-color: #f0f0f0;"><mi>x</mi><mi>y</mi><mi>z</mi></mrow><mo>^</mo></mover></math>
                        </button>
                        <button class="builder-btn accent-btn" data-accent="widetilde" data-position="over" title="Wide Tilde">
                            <math><mover><mrow style="border: 1px solid #666; padding: 2px 4px; background-color: #f0f0f0;"><mi>x</mi><mi>y</mi><mi>z</mi></mrow><mo>∼</mo></mover></math>
                        </button>
                        <button class="builder-btn accent-btn" data-accent="widebar" data-position="over" title="Wide Bar">
                            <math><mover><mrow style="border: 1px solid #666; padding: 2px 4px; background-color: #f0f0f0;"><mi>x</mi><mi>y</mi><mi>z</mi></mrow><mo stretchy="true">‾</mo></mover></math>
                        </button>
                        <button class="builder-btn accent-btn" data-accent="overrightarrow" data-position="over" title="Over Right Arrow">
                            <math><mover><mrow style="border: 1px solid #666; padding: 2px 4px; background-color: #f0f0f0;"><mi>x</mi><mi>y</mi><mi>z</mi></mrow><mo stretchy="true">⟶</mo></mover></math>
                        </button>
                        <button class="builder-btn accent-btn" data-accent="overleftarrow" data-position="over" title="Over Left Arrow">
                            <math><mover><mrow style="border: 1px solid #666; padding: 2px 4px; background-color: #f0f0f0;"><mi>x</mi><mi>y</mi><mi>z</mi></mrow><mo stretchy="true">⟵</mo></mover></math>
                        </button>
                        <button class="builder-btn accent-btn" data-accent="overleftrightarrow" data-position="over" title="Over Left-Right Arrow">
                            <math><mover><mrow style="border: 1px solid #666; padding: 2px 4px; background-color: #f0f0f0;"><mi>x</mi><mi>y</mi><mi>z</mi></mrow><mo stretchy="true">⟷</mo></mover></math>
                        </button>
                    </div>
                    <div class="button-row">
                        <button class="builder-btn accent-btn" data-accent="overbrace" data-position="over" title="Overbrace">
                            <math><mover><mrow style="border: 1px solid #666; padding: 2px 4px; background-color: #f0f0f0;"><mi>x</mi><mi>y</mi><mi>z</mi></mrow><mo stretchy="true">⏞</mo></mover></math>
                        </button>
                        <button class="builder-btn accent-btn" data-accent="underbrace" data-position="under" title="Underbrace">
                            <math><munder><mrow style="border: 1px solid #666; padding: 2px 4px; background-color: #f0f0f0;"><mi>x</mi><mi>y</mi><mi>z</mi></mrow><mo stretchy="true">⏟</mo></munder></math>
                        </button>
                        <button class="builder-btn accent-btn" data-accent="labeledoverbrace" data-position="over" title="Overbrace with Label">
                            <math><mover><mover><mrow style="border: 1px solid #666; padding: 2px 4px; background-color: #f0f0f0;"><mi>x</mi><mi>y</mi><mi>z</mi></mrow><mo stretchy="true">⏞</mo></mover><mrow style="border: 1px solid #999; padding: 1px 2px; font-size: 0.8em;">□</mrow></mover></math>
                        </button>
                        <button class="builder-btn accent-btn" data-accent="labeledunderbrace" data-position="under" title="Underbrace with Label">
                            <math><munder><munder><mrow style="border: 1px solid #666; padding: 2px 4px; background-color: #f0f0f0;"><mi>x</mi><mi>y</mi><mi>z</mi></mrow><mo stretchy="true">⏟</mo></munder><mrow style="border: 1px solid #999; padding: 1px 2px; font-size: 0.8em;">□</mrow></munder></math>
                        </button>
                        <button class="builder-btn accent-btn" data-accent="overparen" data-position="over" title="Over Parenthesis">
                            <math><mover><mrow style="border: 1px solid #666; padding: 2px 4px; background-color: #f0f0f0;"><mi>x</mi><mi>y</mi><mi>z</mi></mrow><mo stretchy="true">⏜</mo></mover></math>
                        </button>
                        <button class="builder-btn accent-btn" data-accent="underparen" data-position="under" title="Under Parenthesis">
                            <math><munder><mrow style="border: 1px solid #666; padding: 2px 4px; background-color: #f0f0f0;"><mi>x</mi><mi>y</mi><mi>z</mi></mrow><mo stretchy="true">⏝</mo></munder></math>
                        </button>
                    </div>
                </div>
                <div id="arrows" class="tab-pane">
                    <!-- Basic arrows -->
                    <div class="button-row">
                        <button class="builder-btn arrow-btn" data-arrow="\rightarrow" title="Right Arrow">→</button>
                        <button class="builder-btn arrow-btn" data-arrow="\leftarrow" title="Left Arrow">←</button>
                        <button class="builder-btn arrow-btn" data-arrow="\uparrow" title="Up Arrow">↑</button>
                        <button class="builder-btn arrow-btn" data-arrow="\downarrow" title="Down Arrow">↓</button>
                        <button class="builder-btn arrow-btn" data-arrow="\leftrightarrow" title="Left-Right Arrow">↔</button>
                        <button class="builder-btn arrow-btn" data-arrow="\updownarrow" title="Up-Down Arrow">↕</button>
                        <button class="builder-btn arrow-btn" data-arrow="\nearrow" title="Northeast Arrow">↗</button>
                        <button class="builder-btn arrow-btn" data-arrow="\searrow" title="Southeast Arrow">↘</button>
                    </div>
                    <!-- Double arrows -->
                    <div class="button-row">
                        <button class="builder-btn arrow-btn" data-arrow="\Rightarrow" title="Double Right Arrow">⇒</button>
                        <button class="builder-btn arrow-btn" data-arrow="\Leftarrow" title="Double Left Arrow">⇐</button>
                        <button class="builder-btn arrow-btn" data-arrow="\Uparrow" title="Double Up Arrow">⇑</button>
                        <button class="builder-btn arrow-btn" data-arrow="\Downarrow" title="Double Down Arrow">⇓</button>
                        <button class="builder-btn arrow-btn" data-arrow="\Leftrightarrow" title="Double Left-Right Arrow">⇔</button>
                        <button class="builder-btn arrow-btn" data-arrow="\Updownarrow" title="Double Up-Down Arrow">⇕</button>
                    </div>
                    <!-- Long and special arrows -->
                    <div class="button-row">
                        <button class="builder-btn arrow-btn" data-arrow="\longrightarrow" title="Long Right Arrow">⟶</button>
                        <button class="builder-btn arrow-btn" data-arrow="\longleftarrow" title="Long Left Arrow">⟵</button>
                        <button class="builder-btn arrow-btn" data-arrow="\longleftrightarrow" title="Long Left-Right Arrow">⟷</button>
                        <button class="builder-btn arrow-btn" data-arrow="\Longrightarrow" title="Long Double Right Arrow">⟹</button>
                        <button class="builder-btn arrow-btn" data-arrow="\Longleftarrow" title="Long Double Left Arrow">⟸</button>
                        <button class="builder-btn arrow-btn" data-arrow="\Longleftrightarrow" title="Long Double Left-Right Arrow">⟺</button>
                    </div>
                    <!-- Curved arrows -->
                    <div class="button-row">
                        <button class="builder-btn arrow-btn" data-arrow="\circlearrowleft" title="Circle Arrow Left">↺</button>
                        <button class="builder-btn arrow-btn" data-arrow="\circlearrowright" title="Circle Arrow Right">↻</button>
                        <button class="builder-btn arrow-btn" data-arrow="\curvearrowleft" title="Curve Arrow Left">↶</button>
                        <button class="builder-btn arrow-btn" data-arrow="\curvearrowright" title="Curve Arrow Right">↷</button>
                        <button class="builder-btn arrow-btn" data-arrow="\hookleftarrow" title="Hook Left Arrow">↩</button>
                        <button class="builder-btn arrow-btn" data-arrow="\hookrightarrow" title="Hook Right Arrow">↪</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stack/Cases Size Selection Panel (Initially Hidden) -->
        <div class="stack-cases-size-panel" id="stackCasesSizePanel" style="display: none;">
            <div class="stack-cases-size-header" id="stackCasesHeader">Select Size</div>
            <div class="stack-cases-panel-content">
                <div class="stack-cases-input-container">
                    <div class="stack-cases-input-row">
                        <label for="stackCasesRows">Number of rows:</label>
                        <input type="number" id="stackCasesRows" min="3" max="10" value="3" class="stack-cases-size-input">
                    </div>
                    <div class="stack-cases-input-hint">Enter a value between 3 and 10</div>
                    <div class="stack-cases-actions">
                        <button id="createStackCasesBtn" class="stack-cases-action-btn stack-cases-create-btn">Create</button>
                        <button id="cancelStackCasesBtn" class="stack-cases-action-btn stack-cases-cancel-btn">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Container for the action buttons and status messages -->
        <div class="footer">
            <div class="footer-controls">
                <button id="clear-equation-button" class="ms-Button ms-Button--secondary">
                    <span class="ms-Button-label">Clear</span>
                </button>
                <button id="insert-equation-button" class="ms-Button ms-Button--primary">
                    <span class="ms-Button-label">Insert Equation</span>
                </button>
            </div>
            <div id="status"></div>
        </div>
        
        <!-- Hidden container for MathJax rendering -->
        <div id="mathjax-renderer"></div>
    </div>
</body>

</html>